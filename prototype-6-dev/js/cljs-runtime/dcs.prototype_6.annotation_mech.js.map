{"version":3,"sources":["dcs/prototype_6/annotation_mech.cljs"],"mappings":";AAGA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKA;AAwBL,AAAA,AAAKC;AAGL,AAAA,AAAMC,AAAiBC,AAASC;AAAhC,AACE,AAACC,AAAOC,AACD,AAACC,AAAI,AAAAC;AAAA,AAAA,AAAAC,AAAAD;AAAA,AAAAE,AAAAD,AAAA,AAAA,AAAME;AAAN,AAAAD,AAAAD,AAAA,AAAA,AAAQG;AAAR,AACE,AAACC,AAAED,AACA,AAACD,AAAAA,AAAAA,AAAEP,AAAAA;AACRD;;AAEd,AAAA,AAAA,AAAA,AAAKW;AAEL,AAAA,AAAMC,AAAkBC,AAAWC;AAAnC,AACE,AAAMd,AAAS,AAACe,AAAMC,AAAOH,AAAWF;AAAxC,AACE,AAACP,AAAI,AAAKH;AAAL,AACE,AAAI,AAACF,AAAgBC,AAASC;AACxBA,AACA,AAAA,AAACgB,AAAkB,AAAA,AAACC,AAAIL,AAAkBf,AAC1C,AAAA,AAACmB,AAAuB,AAAA,AAAK,AAAA,AAACC,AAAIL,AAAkBf,AAA+B,AAAA,AAAOe,AAC1F,AAAA,AAAA,AAACI;;AAELhB;;AACJa;;AAGT,AAAA,AAAA,AAAAK,AAAME;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMD,AACFE,AAAYT;AADhB,AAEG,AAAOU,AAAoBD;AACpBE,AAAoBX;;AAD3B,AAEE,AAAI,AAACY,AAAOF;AACVC;;AACA,AAAO,AAACE,AAAKH;AACN,AAACZ,AAAiB,AAACgB,AAAMJ,AAAkBC;;;;;;;;;AAPzD,AAAA,AAAA,AAAMJ,AAQFE,AAAYT,AAAYe;AAR5B,AASG,AAACC,AAAkBP,AACiB,AAAA,AAAAQ,AAAC3B;AAAD,AAAM,AAAA2B,AAAA,AAACd,AAAqBY;AAD5Bf;;;AATvC,AAAA,AAAA,AAAMO;;AAAN,AAeA,AAAA,AAAMW,AAAgDT,AAAYtB;AAAlE,AACE,AACK,AAACgC,AAAO,AAAKpB,AAEbe;AAFQ,AACE,AAAC7B,AAAgB,AAACgB,AAAMC,AAAOH,AAAWF,AAAgBV;AAFpEsB;;AAOP,AAAA,AAAMW,AAAmBC,AAAOC;AAAhC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAGoED,AAOjD,AAAA,AAAKA,AAAWC","names":["dcs.prototype-6.annotation-mech/layer-annotations","dcs.prototype-6.annotation-mech/default-annotation-symbol","dcs.prototype-6.annotation-mech/record-matches?","criteria","record","cljs.core/every?","cljs.core/true?","cljs.core.map","p__44596","vec__44597","cljs.core.nth","k","v","cljs.core._EQ_","dcs.prototype-6.annotation-mech/non-coord-keys","dcs.prototype-6.annotation-mech/apply-annotation","annotation","target-coll","cljs.core.apply","cljs.core/dissoc","cljs.core.assoc","cljs.core.get","var_args","G__44604","dcs.prototype-6.annotation-mech/apply-annotations","js/Error","annotations","annotations-todo","target-coll-updated","cljs.core/empty?","cljs.core/rest","cljs.core/first","record-type","dcs.prototype_6.annotation_mech.apply_annotations","p1__44602#","dcs.prototype-6.annotation-mech/first-annotation-whose-record-criteria-matches","cljs.core.filter","dcs.prototype-6.annotation-mech/vega-like-tooltip","anchor","text"],"sourcesContent":["(ns dcs.prototype-6.annotation-mech)\n\n\n(def layer-annotations {:transform [{:filter \"datum.annotation != null\"}]\n                        :mark {:type \"text\"\n                               :align \"left\"\n                               ;; :dx 0\n                               ;; :dy -5\n                               ;; _:baseline \"bottom\"\n                               :fontWeight \"bold\"\n                               :fontSize 14\n                               :fill \"blue\"\n                               :fillOpacity 1\n                               :stroke \"white\"\n                               :strokeOpacity 0\n                               :strokeWidth 5}\n                        :encoding {:text {:field \"annotation\"}\n                                   :tooltip [{:field \"annotation-text\" ;; tooltip's tabular format is nicer\n                                              :type  \"nominal\"         \n                                              :title \":\"}]             ;; make the title fairly unnoticable\n                                   ;;:href {:field \"annotation-url\" :type \"nominal\"}\n                                   }})\n\n\n;;\n;; \ud83d\udc4b  \u270b  \u2757  \u2049\ufe0f  \ud83d\udfe2  \u2139\ufe0f  \ud83d\udd0d  \ud83d\udccd \ud83d\udccc \ud83d\udcc8 \ud83d\udcc9 \ud83d\udcca  \u2705  \u274c  \ud83d\udc4e  \ud83d\udc4d  \ud83e\udd14 \ud83e\udd28  \ud83d\ude15  \ud83d\udea9 \ud83d\udcac  \ud83c\udfaf \ud83e\udded \ud83e\udd47 \ud83e\udd48 \ud83e\udd49 \u26a0\ufe0f\n;;\n(def default-annotation-symbol \"\ud83d\udccd\")\n\n\n(defn record-matches? [criteria record]\n  (every? true?\n         (map (fn [[k v]]\n                (= v\n                   (k record))) \n              criteria)))\n\n(def non-coord-keys [:emoji :text])\n\n(defn apply-annotation [annotation target-coll]\n  (let [criteria (apply dissoc annotation non-coord-keys)] ;; ignore anything that isn't contributing to the specification of datapoint coordinates \n    (map (fn [record]\n           (if (record-matches? criteria record)\n             (-> record\n                 (assoc :annotation (get annotation :emoji default-annotation-symbol))\n                 (assoc :annotation-text (str (get annotation :emoji default-annotation-symbol) \" \" (:text annotation)))\n                 (assoc :annotation-url \"#\") ;;TODO maybe replace with View API click event listener\n                 )\n             record))\n         target-coll)))\n\n\n(defn apply-annotations\n  ([annotations target-coll]\n   (loop [annotations-todo    annotations\n          target-coll-updated target-coll]\n     (if (empty? annotations-todo)\n       target-coll-updated\n       (recur (rest annotations-todo)\n              (apply-annotation (first annotations-todo) target-coll-updated)))))\n  ([annotations target-coll record-type] \n   (apply-annotations annotations (->> target-coll\n                                       (map #(assoc % :record-type record-type)) ;; decorate each data point with the given record-type\n                                       ))))\n\n\n\n(defn first-annotation-whose-record-criteria-matches [annotations record]\n  (->> annotations\n       (filter (fn [annotation]\n                 (record-matches? (apply dissoc annotation non-coord-keys) record)))\n       first))\n\n\n\n(defn vega-like-tooltip [anchor text]\n  [:span.dropdown.is-hoverable\n   [:span.dropdown-trigger\n    [:span.is-ghost [:b {:style {:color \"blue\" :font-size \"small\"}} anchor]]]\n   [:span.dropdown-menu\n    [:div#vg-tooltip-like\n     [:table\n      [:tbody\n       [:tr\n        [:td.key \"::\"]\n        [:td.value (str anchor \" \" text)]]]]]]])"]}