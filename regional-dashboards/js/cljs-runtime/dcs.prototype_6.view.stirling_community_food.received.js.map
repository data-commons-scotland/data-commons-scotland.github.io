{"version":3,"sources":["dcs/prototype_6/view/stirling_community_food/received.cljs"],"mappings":";AASA,AAAA,AAAMA,AACCC;AADP,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAM4BA;;AAkB5B,AAAA,AAAMC,AACCD;AADP,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAM6CA;;AAkB7C,AAAA,AAAME,AACCF;AADP,AAEM,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACG,AAAS,AAACF,AAAqBD;;AAGtC,AAAA,AAAMI,AAAQC;AAAd,AACM,AAAMC,AAEgB,AAAA,AAAAI,AAACC;AAAD,AAAM,AAAAD,AAAA,AAACE,AAAgB,AAAA,AAAAF;AADvB,AAAA,AAAAH,AAACC;AAAD,AAAS,AAAA,AAACC,AAAO,AAAA,AAAAF;AADjBF;AAAtB,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAUUQ,AAAa,AAACd,AAAsBO,AAOsB,AAAA,AAACQ,AACV,AAAA,AAACA,AAMlDD,AAAa,AAACZ,AAAqBK,AAGnCO,AAAa,AAACX,AAAiCI;;AAG/D,AAAA,AAAMU;AAAN,AAAA,AAAA,AAAAD,AACOX,AACCa","names":["dcs.prototype-6.view.stirling-community-food.received/chart-spec-per-source","data","dcs.prototype-6.view.stirling-community-food.received/chart-spec-per-month","dcs.prototype-6.view.stirling-community-food.received/chart-spec-per-month-logarithmic","cljs.core/assoc-in","dcs.prototype-6.view.stirling-community-food.received/charts","derivation-tonnes","chart-data","p1__27882#","cljs.core.filter","cljs.core._EQ_","p1__27883#","cljs.core.map","cljs.core.assoc","oz.core/vega-lite","goog.string/unescapeEntities","cljs.core/deref","dcs.prototype-6.view.stirling-community-food.received/root","dcs.prototype-6.state/stirling-community-food-tonnes-derivation-tonnes-cursor"],"sourcesContent":["(ns dcs.prototype-6.view.stirling-community-food.received\n  (:require\n    [reagent.core :as r]\n    [oz.core :as oz]\n    [goog.string :as gstring]\n    [dcs.prototype-6.util :as util]\n    [dcs.prototype-6.state :as state]))\n\n\n(defn chart-spec-per-source\n      [data]\n      {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n       :width      370\n       :height     200\n       :background \"#fff1e5\"\n       :data       {:values data}\n       :transform  [{:aggregate [{:op \"sum\" :field \"tonnes\" :as \"tonnes\"}]\n                     :groupby   [\"source\"]}]\n       :mark       {:type                 \"bar\"\n                    :cornerRadiusTopLeft  3\n                    :cornerRadiusTopRight 3}\n       :encoding   {:x       {:field \"source\" :type \"nominal\"\n                              :axis  {:labelAngle 60\n                                      :labelBound 45}\n                              :sort  {:field \"tonnes\" :order \"descending\"}}\n                    :y       {:field \"tonnes\" :type \"quantitative\"}\n                    :color   {:field  \"source\" :type \"nominal\"\n                              :scale  {:scheme \"tableau20\"}\n                              :legend {:symbolType \"circle\"\n                                       :orient \"bottom\" :columns 4}}\n                    :tooltip [{:field \"source\" :type \"nominal\"}\n                              {:field \"tonnes\" :type \"quantitative\"}]}})\n\n(defn chart-spec-per-month\n      [data]\n      {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n                        :width      370\n                        :height     200\n                        :background \"#fff1e5\"\n                        :data       {:values data}\n                        :transform  [{:timeUnit \"yearmonth\" :field \"yyyy-MM-dd\" :as \"month\"}\n                                     {:aggregate [{:op \"sum\" :field \"tonnes\" :as \"tonnes\"}]\n                                      :groupby [\"month\" \"source\"]}]\n                        :mark       {:type \"line\"\n                                     :point {:filled false :fill \"#fff1e5\"}}\n                        :encoding   {:x       {:field \"month\" :type \"temporal\"\n                                               :axis {:format \"%b %y\"\n                                                      :labelAngle 60\n                                                      :labelBound 45}}\n                                     :y       {:field \"tonnes\" :type \"quantitative\"}\n                                     :color   {:field \"source\" :type \"nominal\"\n                                               :scale {:scheme \"tableau20\"}\n                                               :legend nil #_{:orient \"bottom\" :columns 4}}\n                                     :tooltip [{:field \"source\" :type \"nominal\"}\n                                               {:field \"month\" :type \"temporal\" :format \"%b %Y\"}\n                                               {:field \"tonnes\" :type \"quantitative\"}]}})\n\n(defn chart-spec-per-month-logarithmic\n      [data]\n      (assoc-in (chart-spec-per-month data) [:encoding :y :scale] {:type \"log\"}))\n\n\n(defn charts [derivation-tonnes]\n      (let [chart-data (->> derivation-tonnes\n                            (filter #(= \"in\" (:io-direction %)))\n                            (map #(assoc % :source (:counter-party %))))]\n\n           [:div.tile.is-ancestor\n\n            [:div.tile.is-6\n             [:div.tile.is-vertical.is-parent\n\n              [:div.tile.is-child\n               [oz/vega-lite (chart-spec-per-source chart-data)\n                {:actions false}]]\n              [:div.tile.is-child.content\n               [:p \"The graph above, shows Neighbourly (a collection aggregator)\n               to be the source that supplied the most food material during the year.\"]\n               [:p \"The graphs left, provide a month-by-month breakdown\n               (with the second one using a non-linear scale to make the differences more obvious).\n               It seems that Sainsbury's ceased being a source after Dec\" (gstring/unescapeEntities \"&nbsp;\") \"20,\n               and that Foodcloud started being a source in Apr\" (gstring/unescapeEntities \"&nbsp;\") \"21.\"]]]]\n\n            [:div.tile\n             [:div.tile.is-vertical.is-parent\n\n              [:div.tile.is-child\n               [oz/vega-lite (chart-spec-per-month chart-data)\n                {:actions false}]]\n              [:div.tile.is-child\n               [oz/vega-lite (chart-spec-per-month-logarithmic chart-data)\n                {:actions false}]]]]]))\n\n(defn root []\n      [charts\n       @state/stirling-community-food-tonnes-derivation-tonnes-cursor])"]}