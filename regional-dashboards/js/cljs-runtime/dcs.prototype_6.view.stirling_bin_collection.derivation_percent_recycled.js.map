{"version":3,"sources":["dcs/prototype_6/view/stirling_bin_collection/derivation_percent_recycled.cljs"],"mappings":";AAOA,AAAA,AAAMA,AAAYC,AAAMC;AAAxB,AACM,AAAMC,AAAW,AAACC,AAAM,AAAA,AAACC,AAAeH;AAAxC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAM2BA,AAOoBC;;AAarD,AAAA,AAAMG,AAAOC,AAAoDC;AAAjE,AACM,AACMC,AAEkD,AAAA,AAAAI,AAACC;AAAD,AAAM,AAAAD,AAAA,AAACE,AAAgB,AAAA,AAAK,AAAA,AAAAF;AAD5B,AAAA,AAAAH,AAACC;AAAD,AAAS,AAAA,AAAA,AAAA,AAACC,AAAmC,AAAA,AAAAF;AAD7CF;AAKlDQ,AAAqD,AAAA,AAAAC,AAACH;AAAD,AAAM,AAAAG,AAAA,AAAA,AAACF;AACRR;AAGpDW,AAA6B,AAACC,AAAOH,AACNP;AAG/BW,AAA8B,AAAA,AAAAC,AAACP;AAAD,AAAM,AAAAO,AAAA,AAACN,AAAc,AAAK,AAAA,AAAAM;AAC1BH;AAfpC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAkBOI,AAAa,AAAA,AAACtB,AAAgDoB;;AAG3E,AAAA,AAAMI;AAAN,AAAA,AAAA,AAAAD,AAAA,AAAAA,AACOjB,AACCmB,AACAC","names":["dcs.prototype-6.view.stirling-bin-collection.derivation-percent-recycled/chart-spec","title","data","year-count","cljs.core/count","cljs.core/group-by","dcs.prototype-6.view.stirling-bin-collection.derivation-percent-recycled/chart","stirling-bin-collection-derivation-percent-recycled","household-waste-derivation-percent-recycled","household-waste-derivation-percent-recycled'","p1__29236#","cljs.core.filter","cljs.core/contains?","p1__29237#","cljs.core.map","cljs.core.assoc","stirling-bin-collection-derivation-percent-recycled'","p1__29238#","derivation-percent-recycled'","cljs.core.concat","derivation-percent-recycled''","p1__29239#","oz.core/vega-lite","cljs.core/deref","dcs.prototype-6.view.stirling-bin-collection.derivation-percent-recycled/root","dcs.prototype-6.state/stirling-bin-collection-derivation-percent-recycled-cursor","dcs.prototype-6.state/household-waste-derivation-percent-recycled-cursor"],"sourcesContent":["(ns dcs.prototype-6.view.stirling-bin-collection.derivation-percent-recycled\n  (:require\n    [reagent.core :as r]\n    [oz.core :as oz]\n    [dcs.prototype-6.state :as state]))\n\n\n(defn chart-spec [title data]\n      (let [year-count (count (group-by :year data))]\n           {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n            ;;:title      title\n            :width      200\n            :height     100\n            :background \"floralwhite\"\n            :data       {:values data}\n            :mark       {:type \"line\" :point false #_{:filled false :fill \"floralwhite\"}}\n            :selection  {:my {:type   \"multi\"\n                              :fields [\"region\"]\n                              :bind   \"legend\"}}\n            :encoding   {:x       {:field \"year\" :type \"temporal\"\n                                   :timeUnit \"year\"\n                                   :axis {:tickCount year-count :title \"year\"}}\n                         :y       {:field \"percentage\" :type \"quantitative\"\n                                   #_:scale #_{:zero false}}\n                         :color   {:field \"region\" :type \"nominal\"\n                                   :scale {:domain [\"Scotland (recycled overall)\" \"Stirling (recycled overall)\" \"Stirling (recycling bin collection)\"]\n                                           :range [\"#bcd6e9\" \"#fedfc4\" \"#BF5748\"]}\n                                   :axis {:title \"category\"}}\n                         :opacity {:condition {:selection \"my\" :value 1}\n                                   :value     0.2}\n                         :tooltip [{:field \"region\" :type \"nominal\" :title \"category\"}\n                                   {:field \"year\" :type \"temporal\"}\n                                   {:field \"percentage\" :type \"quantitative\"}]}}))\n\n(defn chart [stirling-bin-collection-derivation-percent-recycled household-waste-derivation-percent-recycled]\n      (let [;; filter for Scotland and Stirling in the more general household waste data\n            household-waste-derivation-percent-recycled' (->> household-waste-derivation-percent-recycled\n                                                              (filter #(contains? #{\"Scotland\" \"Stirling\"} (:region %))) ;; we only want Scotland and Stirling\n                                                              (map #(assoc % :region (str (:region %) \" (recycled overall)\")))) ;; re-label\n\n            ;; add \" (bins)\" to the label for Stirling\n            stirling-bin-collection-derivation-percent-recycled' (map #(assoc % :region \"Stirling (recycling bin collection)\")\n                                                                stirling-bin-collection-derivation-percent-recycled)\n\n            ;; combine Stirling bin collection data with that for the more general household waste of Stirling and Scotland\n            derivation-percent-recycled' (concat stirling-bin-collection-derivation-percent-recycled'\n                                           household-waste-derivation-percent-recycled')\n\n            ;; stringify the year for Vega\n            derivation-percent-recycled'' (map #(assoc % :year (str (:year %)))\n                                          derivation-percent-recycled')]\n\n           [:div\n            [oz/vega-lite (chart-spec \"% for the recycling bin collection\" derivation-percent-recycled'')\n             {:actions false}]]))\n\n(defn root []\n      [chart\n       @state/stirling-bin-collection-derivation-percent-recycled-cursor\n       @state/household-waste-derivation-percent-recycled-cursor])"]}