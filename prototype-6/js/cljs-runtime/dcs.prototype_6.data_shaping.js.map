{"version":3,"sources":["dcs/prototype_6/data_shaping.cljs"],"mappings":"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","names":["dcs.prototype-6.data-shaping/trend","xy-pairs","rf","kixi.stats.core/simple-linear-regression","cljs.core/first","cljs.core/second","jsobj","cljs.core.transduce","cljs.core/identity","dcs.prototype-6.data-shaping/rollup-population-regions","population","cljs.core/group-by","cljs.core.map","p__58395","vec__58396","cljs.core.nth","year","coll","cljs.core.apply","cljs.core/+","dcs.prototype-6.data-shaping/rollup-household-co2e-regions","household-co2e","p__58399","vec__58400","dcs.prototype-6.data-shaping/rollup-household-waste-regions","household-waste","cljs.core.juxt","p__58403","vec__58404","vec__58407","material","management","dcs.prototype-6.data-shaping/rollup-business-waste-by-region-regions","business-waste-by-region","p__58410","vec__58411","vec__58414","dcs.prototype-6.data-shaping/rollup-household-waste-materials-and-management","p__58417","vec__58418","vec__58421","region","dcs.prototype-6.data-shaping/rollup-household-waste-materials","p__58424","vec__58425","vec__58428","dcs.prototype-6.data-shaping/rollup-household-waste-managements","p__58431","vec__58432","vec__58435","dcs.prototype-6.data-shaping/calc-household-waste-percentage-recycled","p__58439","vec__58440","vec__58443","total-tonnes","recycled-tonnes","p1__58438#","cljs.core.filter","cljs.core._EQ_","dcs.prototype-6.data-shaping/rollup-business-waste-by-region-materials","p__58446","vec__58447","vec__58450","dcs.prototype-6.data-shaping/count-waste-sites-per-category-per-region","waste-site","p1__58453#","cljs.core.remove","p__58455","vec__58456","all","cljs.core/count","household","p1__58454#","cljs.core/contains?","cljs.core/set","non-household","dcs.prototype-6.data-shaping/rollup-stirling-bin-collection-ma-re-mi","stirling-bin-collection","p__58459","vec__58460","vec__58463","quarter","dcs.prototype-6.data-shaping/rollup-stirling-bin-collection-re-mi","p__58466","vec__58467","vec__58470","dcs.prototype-6.data-shaping/calc-stirling-bin-collection-percentage-recycled","p__58474","vec__58475","vec__58478","p1__58473#","dcs.prototype-6.data-shaping/calc-stirling-community-food-flow","stirling-community-food-tonnes","counter-party","p1__58481#","subflows","p1__58482#","counter-parties","p1__58483#","source-keys","p1__58484#","cljs.core.distinct","not-waste-sources","waste-sources","p1__58485#","used-as-food-outcomes","not-used-as-food-outcomes","subflows-1a","iter__4564__auto__","s__58487","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4562__auto__","size__4563__auto__","b__58489","cljs.core/chunk-buffer","i__58488","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__58486","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","from","sum-counter-party-tonnes","subflows-1b","s__58491","b__58493","i__58492","iter__58490","subflows-2","sum-subflows-tonnes","subflows-3","sum-counter-parties-tonnes","subflows-4","s__58495","b__58497","i__58496","iter__58494","to","ordered-froms","ordered-tos","comparator","p__58498","p__58499","vec__58500","vec__58503","a-from","a-to","b-from","b-to","cljs.core.not_EQ_","flow","cljs.core.sort_by","cljs.core.concat","dcs.prototype-6.data-shaping/calc-ace-furniture-trends","sold-counts","yyyy-MM-dds","month-counts","sold-items-by-avg-count-per-month-at-x","p__58509","vec__58510","vec__58513","category","item","s__58517","b__58519","i__58518","iter__58516","x","yyyy-MM-dd","cljs.core.get","period-count","or__4160__auto__","p1__58506#","avg-count","cljs.core/flatten","sold-categories-by-avg-count-per-month-trend","p__58526","vec__58527","vec__58530","p__58520","vec__58521","_","trend-val","p__58524","map__58525","cljs.core/--destructure-map","p1__58507#","cljs.core.assoc","cljs.core/reverse","sold-items-by-avg-count-per-month-trend","p__58533","vec__58534","vec__58537","p__58540","map__58541","p1__58508#","dcs.prototype-6.data-shaping/calc-ace-furniture-flights-worth","sold-weights","furniture-to-waste-streams","co2e-multiplier","furniture->waste-stream","p__58542","map__58543","waste-stream","cljs.core.into","waste-stream->multiplier","p__58544","map__58545","multiplier","get-co2e-multiplier","sold-weights-with-co2es","p__58546","map__58547","weight","m","flights-per-category","p__58552","vec__58553","p__58550","map__58551","co2e","Math/round","p__58548","map__58549","flights","cljs.core.repeat","flights-per-item","p__58560","vec__58561","vec__58564","p__58558","map__58559","p__58556","map__58557","cljs.core/chunk-first"],"sourcesContent":["(ns dcs.prototype-6.data-shaping\n  (:require [kixi.stats.core :as stats]))\n\n\n; Compute 'the trend of y'.\n; (Returns the gradient of a linear approximation to the curve decribed by xy-pairs.)\n(defn trend [xy-pairs]\n      (let [rf (stats/simple-linear-regression first second)\n            ^js jsobj (transduce identity rf xy-pairs)]\n           (. jsobj -slope)))\n\n\n;; Roll-up to get values for Scotland as a whole\n(defn rollup-population-regions [population]\n      (->> population\n           (group-by :year)\n           (map (fn [[year coll]] {:region     \"Scotland\"\n                                   :year       year\n                                   :population (->> coll\n                                                    (map :population)\n                                                    (apply +))}))))\n\n;; Roll-up to get values for Scotland as a whole\n(defn rollup-household-co2e-regions [household-co2e]\n      (->> household-co2e\n           (group-by :year)\n           (map (fn [[year coll]] {:region \"Scotland\"\n                                   :year   year\n                                   :tonnes (->> coll\n                                                (map :tonnes)\n                                                (apply +))}))))\n\n;; Roll-up to get values for Scotland as a whole\n(defn rollup-household-waste-regions [household-waste]\n      (->> household-waste\n           (group-by (juxt :year :material :management))\n           (map (fn [[[year material management] coll]] {:region     \"Scotland\"\n                                                         :year       year\n                                                         :material   material\n                                                         :management management\n                                                         :tonnes     (->> coll\n                                                                          (map :tonnes)\n                                                                          (apply +))}))))\n\n;; Roll-up to get values for Scotland as a whole\n(defn rollup-business-waste-by-region-regions [business-waste-by-region]\n      (->> business-waste-by-region\n           (group-by (juxt :year :material))\n           (map (fn [[[year material] coll]] {:region   \"Scotland\"\n                                              :year     year\n                                              :material material\n                                              :tonnes   (->> coll\n                                                             (map :tonnes)\n                                                             (apply +))}))))\n\n;; Roll-up to get values for (region, year) pairs\n(defn rollup-household-waste-materials-and-management [household-waste]\n      (->> household-waste\n           (group-by (juxt :region :year))\n           (map (fn [[[region year] coll]] {:region region\n                                            :year   year\n                                            :tonnes (->> coll\n                                                         (map :tonnes)\n                                                         (apply +))}))))\n\n;; Roll-up to get values for (region, year, management) triples\n(defn rollup-household-waste-materials [household-waste]\n      (->> household-waste\n           (group-by (juxt :region :year :management))\n           (map (fn [[[region year management] coll]] {:region     region\n                                                       :year       year\n                                                       :management management\n                                                       :tonnes     (->> coll\n                                                                        (map :tonnes)\n                                                                        (apply +))}))))\n\n;; Roll-up to get values for (region, year, material) triples\n(defn rollup-household-waste-managements [household-waste]\n      (->> household-waste\n           (group-by (juxt :region :year :material))\n           (map (fn [[[region year material] coll]] {:region     region\n                                                       :year       year\n                                                       :material   material\n                                                       :tonnes     (->> coll\n                                                                        (map :tonnes)\n                                                                        (apply +))}))))\n\n;; Calculate the percentage recycled values for (region, year) pairs\n(defn calc-household-waste-percentage-recycled [household-waste]\n      (->> household-waste\n           (group-by (juxt :region :year))\n           (map (fn [[[region year] coll]] {:region     region\n                                            :year       year\n                                            :percentage (let [total-tonnes (->> coll\n                                                                                (map :tonnes)\n                                                                                (apply +))\n                                                              recycled-tonnes (->> coll\n                                                                                   (filter #(= \"Recycled\" (:management %)))\n                                                                                   (map :tonnes)\n                                                                                   (apply +))]\n                                                             (double (* 100 (/ recycled-tonnes total-tonnes))))}))))\n\n;; Roll-up to get values for (region, year) pairs\n(defn rollup-business-waste-by-region-materials [business-waste-by-region]\n      (->> business-waste-by-region\n           (group-by (juxt :region :year))\n           (map (fn [[[region year] coll]] {:region region\n                                            :year   year\n                                            :tonnes (->> coll\n                                                         (map :tonnes)\n                                                         (apply +))}))))\n\n;; Count the waste sites per category in each region\n(defn count-waste-sites-per-category-per-region [waste-site]\n      (->> waste-site\n           (remove #(= \"Not operational\" (:status %)))\n           (group-by :region)\n           (map (fn [[region coll]] (let [all (count coll)\n                                          household (->> coll\n                                                         (filter #(contains? (set (:accepts %)) \"Household\"))\n                                                         count)\n                                          non-household (- all household)]\n                                         {:region        region\n                                          :household     household\n                                          :non-household non-household})))))\n\n\n;; Roll-up to get values for (region, year, quarter) triples\n(defn rollup-stirling-bin-collection-ma-re-mi [stirling-bin-collection]\n      (->> stirling-bin-collection\n           (group-by (juxt :region :year :quarter))\n           (map (fn [[[region year quarter] coll]] {:region  region\n                                                    :year    year\n                                                    :quarter quarter\n                                                    :tonnes  (->> coll\n                                                                  (map :tonnes)\n                                                                  (apply +))}))))\n\n\n;; Roll-up to get values for (region, year, quarter, material) quadruples\n(defn rollup-stirling-bin-collection-re-mi [stirling-bin-collection]\n      (->> stirling-bin-collection\n           (group-by (juxt :region :year :quarter :material))\n           (map (fn [[[region year quarter material] coll]] {:region   region\n                                                             :year     year\n                                                             :quarter  quarter\n                                                             :material material\n                                                             :tonnes   (->> coll\n                                                                            (map :tonnes)\n                                                                            (apply +))}))))\n\n\n;; Calculate the percentage recycled values for (region, year, quarter) triples\n(defn calc-stirling-bin-collection-percentage-recycled [stirling-bin-collection]\n      (->> stirling-bin-collection\n           (group-by (juxt :region :year :quarter))\n           (map (fn [[[region year quarter] coll]] {:region     region\n                                                    :year       year\n                                                    :quarter    quarter\n                                                    :percentage (let [total-tonnes (->> coll\n                                                                                        (map :tonnes)\n                                                                                        (apply +))\n                                                                      recycled-tonnes (->> coll\n                                                                                           (filter #(:recycling? %))\n                                                                                           (map :tonnes)\n                                                                                           (apply +))]\n                                                                     (double (* 100 (/ recycled-tonnes total-tonnes))))}))))\n\n\n;; Calculate the flow (paths and amounts) of food material through the Stirling Community Food system\n(defn calc-stirling-community-food-flow [stirling-community-food-tonnes]\n      (letfn [(sum-counter-party-tonnes [counter-party]\n                                           (->> stirling-community-food-tonnes\n                                                (filter #(and (= \"in\" (:io-direction %))\n                                                              (= counter-party (:counter-party %))))\n                                                (map :tonnes)\n                                                (apply +)))\n\n              (sum-subflows-tonnes [subflows]\n                                      (->> subflows\n                                           (map #(nth % 2))\n                                           (apply +)))\n\n              (sum-counter-parties-tonnes [counter-parties]\n                                             (->> stirling-community-food-tonnes\n                                                  (filter #(and (= \"out\" (:io-direction %))\n                                                                (contains? counter-parties (:counter-party %))))\n                                                  (map :tonnes)\n                                                  (apply +)))]\n\n             (let [source-keys (->> stirling-community-food-tonnes\n                                    (filter #(= \"in\" (:io-direction %)))\n                                    (map :counter-party)\n                                    distinct)\n\n                   not-waste-sources #{\"Purchased\" \"Donated not waste\"}\n                   waste-sources (remove #(contains? not-waste-sources %) source-keys)\n\n                   used-as-food-outcomes #{\"Used as food\"}\n                   not-used-as-food-outcomes #{\"Donated to animal sanctuary\" \"Used by individuals for compost\" \"Council compost, Energen biogas, etc.\"}\n\n                   subflows-1a\n                   (for [from waste-sources]\n                        [from \"Would-be waste\" (sum-counter-party-tonnes from)])\n\n                   subflows-1b\n                   (for [from not-waste-sources]\n                        [from \"Not waste\" (sum-counter-party-tonnes from)])\n\n                   subflows-2\n                   [[\"Not waste\" \"Stirling Community Food\" (sum-subflows-tonnes subflows-1b)]\n                    [\"Would-be waste\" \"Stirling Community Food\" (sum-subflows-tonnes subflows-1a)]]\n\n                   subflows-3\n                   [[\"Stirling Community Food\" \"Used as food\" (sum-counter-parties-tonnes used-as-food-outcomes)]\n                    [\"Stirling Community Food\" \"Not used as food\" (sum-counter-parties-tonnes not-used-as-food-outcomes)]]\n\n                   subflows-4\n                   (for [to not-used-as-food-outcomes]\n                        [\"Not used as food\" to (sum-counter-parties-tonnes #{to})])\n\n                   ;; concat and order them\n\n                   ordered-froms [\"Purchased\"\n                             \"Donated not waste\"\n                             \"Local supermarkets\"\n                             \"Fareshare\"\n                             \"Donated as waste\"\n                             \"Other\"\n                             \"Not waste\"\n                             \"Would-be waste\"\n                             \"Stirling Community Food\"]\n\n                   ordered-tos [\"Used as food\" ;; should be no need to worry about the earlier ones in the flow\n                                \"Not used as food\"\n                                \"Donated to animal sanctuary\"\n                                \"Used by individuals for compost\"\n                                \"Council compost, Energen biogas, etc.\"]\n\n                   comparator (fn [[a-from a-to] [b-from b-to]] (if (not= a-from b-from)\n                                                      (< (.indexOf ordered-froms a-from) (.indexOf ordered-froms b-from))\n                                                      (< (.indexOf ordered-tos a-to) (.indexOf ordered-tos b-to))))\n\n                   flow (sort-by (juxt first second)\n                                 comparator\n                                 (concat subflows-1a subflows-1b subflows-2 subflows-3 subflows-4))]\n\n                  flow)))\n\n;; Calculate for the ACE furniture sold counts,\n;;   the avg-count-per-month for each accounting period (for each category/item)\n;;   and then the trend (for each category/item).\n(defn calc-ace-furniture-trends [sold-counts]\n      (let [;; The x value for a yyyy-MM-dd, is the yyyy-MM-dd's index\n            yyyy-MM-dds [\"2018-02-28\" \"2019-02-28\" \"2019-08-31\"]\n\n            ;; The x value for a month-count, is the month-count's index\n            month-counts [12 12 6]\n\n            sold-items-by-avg-count-per-month-at-x (->> sold-counts\n                                                        (group-by (juxt :category :item))\n                                                        (map (fn [[[category item] coll]] (for [x [0 1 2]]\n                                                                                               (let [yyyy-MM-dd (get yyyy-MM-dds x)\n                                                                                                     period-count (or (->> coll\n                                                                                                                           (filter #(= yyyy-MM-dd (:yyyy-MM-dd %)))\n                                                                                                                           first\n                                                                                                                           :count)\n                                                                                                                      0)\n                                                                                                     avg-count (/ period-count (get month-counts x))]\n                                                                                                    {:category   category\n                                                                                                     :item       item\n                                                                                                     :yyyy-MM-dd yyyy-MM-dd\n                                                                                                     :x          x\n                                                                                                     :period-count period-count\n                                                                                                     :avg-count  avg-count}))))\n                                                        flatten\n                                                        (sort-by (juxt :category :item :yyyy-MM-dd :x)))\n\n            sold-categories-by-avg-count-per-month-trend (->> sold-items-by-avg-count-per-month-at-x\n                                                              (group-by (juxt :category :yyyy-MM-dd :x))\n                                                              (map (fn [[[category yyyy-MM-dd x] coll]] {:category   category\n                                                                                                         :yyyy-MM-dd yyyy-MM-dd\n                                                                                                         :x          x\n                                                                                                         :period-count (->> coll\n                                                                                                                            (map :period-count)\n                                                                                                                            (apply +))\n                                                                                                         :avg-count  (->> coll\n                                                                                                                          (map :avg-count)\n                                                                                                                          (apply +))}))\n                                                              (group-by :category)\n                                                              (map (fn [[_ coll]] (let [trend-val (trend (map (fn [{:keys [x avg-count]}] [x avg-count]) coll))]\n                                                                                       ;; put this calculated trend-val into each item in the coll\n                                                                                       (map #(assoc % :trend trend-val) coll))))\n                                                              flatten\n                                                              (sort-by :trend)\n                                                              reverse)\n\n            sold-items-by-avg-count-per-month-trend (->> sold-items-by-avg-count-per-month-at-x\n                                                         (group-by (juxt :category :item))\n                                                         (map (fn [[[_ _] coll]] (let [trend-val (trend (map (fn [{:keys [x avg-count]}] [x avg-count]) coll))]\n                                                                                      ;; put this calculated trend-val into each item in the coll\n                                                                                      (map #(assoc % :trend trend-val) coll))))\n                                                         flatten\n                                                         (sort-by :trend)\n                                                         reverse)]\n\n           [sold-categories-by-avg-count-per-month-trend sold-items-by-avg-count-per-month-trend]))\n\n;; Calculate for the ACE furniture sold weights,\n;;   the flights-worth-of-CO2e for each category/item.\n(defn calc-ace-furniture-flights-worth [sold-weights furniture-to-waste-streams co2e-multiplier]\n  (let [furniture->waste-stream  (->> furniture-to-waste-streams\n                                      (map (fn [{:keys [category item waste-stream]}] [[category item] waste-stream]))\n                                      (into {}))\n        waste-stream->multiplier (->> co2e-multiplier\n                                      (map (fn [{:keys [waste-stream multiplier]}] [waste-stream multiplier]))\n                                      (into {}))\n        get-co2e-multiplier      (fn [category item]\n                                   (->> [category item]\n                                        (get furniture->waste-stream)\n                                        (get waste-stream->multiplier)))\n        sold-weights-with-co2es  (->> sold-weights\n                                      (map (fn [{:keys [category item weight]\n                                                 :as   m}]\n                                             (assoc m\n                                                    :co2e (* weight (get-co2e-multiplier category item))))))\n        flights-per-category (->> sold-weights-with-co2es\n                                               ;; roll-up to per-category\n                                  (group-by :category)\n                                  (map (fn [[category coll]]\n                                         {:category category\n                                          :co2e     (apply + (map :co2e coll))}))\n                                               ;; and calcuate the avoided CO2e in terms of flights (Glasgow -> Berlin, one-way)\n                                               ;; 202.5 = average kg of CO2e per flight \n                                  (map (fn [{:keys [category co2e]}]\n                                         {:category category\n                                          :co2e     co2e\n                                          :flights  (int (Math/round (/ co2e 202.5)))}))\n                                               ;; for a Vega emoji representation, create a record per flight\n                                  (map (fn [{:keys [category co2e flights]}]\n                                         (repeat flights\n                                                 {:co2e          co2e\n                                                  :category      category\n                                                  :flights-total flights\n                                                  :flight        1})))\n                                  flatten)\n        flights-per-item (->> sold-weights-with-co2es\n                          ;; roll-up to per-item\n                              (group-by (juxt :category :item))\n                              (map (fn [[[category item] coll]]\n                                     {:category category\n                                      :item     item\n                                      :co2e     (apply + (map :co2e coll))}))\n                          ;; and calcuate the avoided CO2e in terms of flights (Glasgow -> Berlin, one-way)\n                          ;; 202.5 = average kg of CO2e per flight \n                              (map (fn [{:keys [category item co2e]}]\n                                     {:category category\n                                      :item     item\n                                      :co2e     co2e\n                                      :flights  (int (Math/round (/ co2e 202.5)))}))\n                          ;; for a Vega emoji representation, create a record per flight\n                              (map (fn [{:keys [category item co2e flights]}]\n                                     (repeat flights\n                                             {:co2e          co2e\n                                              :category      category\n                                              :item          item\n                                              :flights-total flights\n                                              :flight        1})))\n                              flatten)]\n    \n    [flights-per-category flights-per-item]))"]}