{"version":3,"sources":["dcs/prototype_6/view/fairshare/cars_worth.cljs"],"mappings":"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","names":["dcs.prototype-6.view.fairshare.cars-worth/chart-spec-cars-worth","data","title","dcs.prototype-6.view.fairshare.cars-worth/charts","co2e","car-co2e","cljs.core/group-by","cljs.core.map","p__35186","vec__35187","cljs.core.nth","year","coll","cljs.core.apply","cljs.core/+","p__35184","map__35185","cljs.core/--destructure-map","cljs.core.get","Math/round","p__35182","map__35183","cars","cljs.core.repeat","cljs.core/flatten","cljs.core/cons","oz.core/vega-lite","dcs.prototype-6.util/vega-embed-opts","reitit.frontend.easy.href","cljs.core/deref","dcs.prototype-6.view.fairshare.cars-worth/root","dcs.prototype-6.state/fairshare-derivation-co2e-cursor"],"sourcesContent":["(ns dcs.prototype-6.view.fairshare.cars-worth\n  (:require\n    [reitit.frontend.easy :as rfe]\n    [oz.core :as oz]\n    [dcs.prototype-6.util :as util]\n    [dcs.prototype-6.state :as state]))\n\n(defn chart-spec-cars-worth\n      [data title]\n      {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n       :width      300\n       :height     450\n       :title      title\n       :background \"#f2dfce\"                                ;  \"#980f3d\"  \"#fff1e5\"\n       :data       {:values data}\n       :transform  [{:calculate \"datum.car==1 ? '\ud83d\ude97' : ''\" :as \"emoji\"}\n                    {:window  [{:op \"sum\" :field \"car\" :as \"cars\"}]\n                     :groupby [\"date\"]}]\n       :mark       {:type  \"text\"\n                    :align \"center\"}\n       :encoding   {:x       {:title \"year\"\n                              :field \"date\" :type \"temporal\"\n                              :axis  {:format     \"%Y\"\n                                      :labelAngle 45\n                                      :labelBound 50\n                                      }}\n                    :y       {:field \"cars\"\n                              :type  \"quantitative\"\n                              :axis  {:title \"equivalent number of cars\"}}\n                    :text    {:field \"emoji\" :type \"nominal\"}\n                    :size    {:value 15}\n                    :tooltip [{:title \"year\" :field \"date\" :type \"temporal\" :format \"%Y\"}\n                              {:title \"tonnes of CO2e\" :field \"year-co2e\" :type \"quantitative\"}\n                              {:title \"equivalent number of cars\" :field \"year-cars\" :type \"quantitative\"}]}\n       :config     {\n                    :axisX {:grid false}}})\n\n\n(defn charts [co2e]\n  (let [car-co2e (->> co2e\n                          ;; roll-up to per-year\n                      (group-by :year)\n                      (map (fn [[year coll]]\n                             {:year year\n                              :co2e (apply + (map :tonnes coll))}))\n                          ;; and calcuate the avoided CO2e in terms of cars\n                          ;; 4.9 = average tonnes of CO2e per car per year (incorporates exhaust emissions, fuel supply chain, car material)\n                      (map (fn [{:keys [year co2e]}]\n                             {:year year\n                              :co2e co2e\n                              :cars (int (Math/round (/ co2e 4.1)))}))\n                          ;; for a Vega emoji representation, create a record per car\n                      (map (fn [{:keys [year co2e cars]}]\n                             (repeat cars\n                                     {:date      (str year \"-01-01\")\n                                      :year-co2e co2e\n                                      :year-cars cars\n                                      :car       1})))\n                      flatten\n                          ;; workaround a Vega rendering issue by delimiting the year range with empty valued records\n                      (cons {:date      \"2012-01-01\"\n                             :year-co2e 0\n                             :year-cars 0\n                             :car       0})\n                      (cons {:date      \"2020-01-01\"\n                             :year-co2e 0\n                             :year-cars 0\n                             :car       0}))]\n\n    [:div.columns\n     [:column\n      [oz/vega-lite (chart-spec-cars-worth car-co2e \"Graph 1: Cars-worth of CO2e avoided per year\")\n       util/vega-embed-opts]\n      ]\n     [:column\n      [:div.m-4.content\n       [:p \"Each item reused through The Fair Share, is an item that has avoided becoming waste/pollution.\"\n        \" Pollution is often estimated in terms of CO\" [:sub \"2\"] \"e,\"\n        \" and The Fair Share data contains CO\" [:sub \"2\"] \"e\" [:sup \"a\"] \" values for this avoided waste/pollution.\"]\n       [:p \" But by themselves, CO\" [:sub \"2\"] \"e values can be difficult to relate to so\"\n        \" we convert them into in a more relatable measure: \" [:em \"cars worth\"] \" of CO\" [:sub \"2\"] \"e (as shown in Graph 1).\"]\n       [:p \"The average cost of using one car for one year is 4.1\" [:sup \"b\"] \" tonnes of CO\" [:sub \"2\"] \"e.\"\n        \" This incorporates as exhaust emissions, fuel supply chain and amortised car material for the average UK car.\"]\n       [:p \"So, we divide The Fair Share's CO\" [:sub \"2\"] \"e values by 4.1 to yield our \" [:em \"cars worth\"] \" of CO\" [:sub \"2\"] \"e values\"\n        \" then use these to plot this graph.\"]\n       [:p.has-text-success \"This small store has enabled an impressive amount of CO\" [:sub \"2\"] \"e avoidance.\"]\n       [:p.has-text-grey \"The 2014 spike was caused by an unusually large donation of textiles\" [:sup \"c\"] \" (duvet covers, sheets, pillowcases)\"\n        \" from the student halls of residence.\"]\n       [:div.content.is-small.has-text-info\n        [:ol.is-lower-alpha\n         [:li \"The Fair Share have calculated their CO\" [:sub \"2\"] \"e values using \"\n          [:a {:href   \"https://ghgprotocol.org/Third-Party-Databases/Defra\"\n               :target \"_blank\"} \"Defra\"] \" formulae.\"]\n         [:li \"A rough approximation based on figures from \"\n          [:a {:href   \"https://www.brusselsblog.co.uk/carbon-emissions-in-the-lifetimes-of-cars/\"\n               :target \"_blank\"} \"Carbon emissions in the lifetimes of cars\"]\n          \" and \"\n          [:a {:href   \"https://www.ovoenergy.com/ovo-newsroom/press-releases/2019/november/think-before-you-thank-if-every-brit-sent-one-less-thank-you-email-a-day-we-would-save-16433-tonnes-of-carbon-a-year-the-same-as-81152-flights-to-madrid.html\"\n               :target \"_blank\"} \"OVO Energy\"]\n          \".\" [:sub \"2\"]]\n         [:li \"And textiles have the highest CO2e weighting according to \"\n          [:a {:href (rfe/href :dcs.prototype-6.router/data-view nil {:target \"co2e-multiplier\"})} \"The Scottish Carbon Metric multiplier table\"] \".\"]]]]]]))\n\n(defn root []\n      [charts\n       @state/fairshare-derivation-co2e-cursor])"]}