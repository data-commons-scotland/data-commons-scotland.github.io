{"version":3,"sources":["dcs/prototype_6/loader.cljs"],"mappings":"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","names":["dcs.prototype-6.loader/fetch","url","body-handler","js/console.log","c__29103__auto__","cljs.core.async.chan","cljs.core.async.impl.dispatch/run","f__29104__auto__","switch__29018__auto__","state_38692","state_val_38697","statearr-38716","inst_38653","inst_38656","inst_38657","inst_38658","cljs.core/PersistentHashMap","inst_38659","statearr-38724","cljs.core.async.impl.ioc-helpers/take!","inst_38668","inst_38677","statearr-38725","statearr-38726","inst_38679","inst_38680","statearr-38728","inst_38674","inst_38675","statearr-38729","inst_38661","inst_38663","inst_38664","inst_38665","inst_38666","inst_38667","inst_38672","statearr-38730","statearr-38731","statearr-38733","inst_38685","statearr-38734","statearr-38736","inst_38689","inst_38690","cljs.core.async.impl.ioc-helpers/return-chan","statearr-38740","inst_38687","statearr-38741","statearr-38742","state-machine__29019__auto__","ret-value__29020__auto__","result__29021__auto__","cljs.core/keyword-identical?","ex__29022__auto__","e38743","statearr-38744","cljs.core/seq","statearr-38745","cljs.core/first","state__29105__auto__","statearr-38746","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","dcs.prototype-6.util/now","cljs_http.client.get","dcs.prototype-6.util/secs-to-now","clojure.string/ends-with?","testdouble.cljs.csv/read-csv","clojure.string/replace","cljs.core.js__GT_clj","js/JSON","dcs.prototype-6.loader/load-data","ace-furniture-count","cljs.core/reset!","dcs.prototype-6.state/ace-furniture-count-holder","ace-furniture-avg-weight","dcs.prototype-6.state/ace-furniture-avg-weight-holder","geojson","cljs.core/clj->js","dcs.prototype-6.state/geojson-cursor","regional-dashboard-annotations","dcs.prototype-6.state/regional-dashboard-annotations-holder","household-waste-analysis-annotations","dcs.prototype-6.state/household-waste-analysis-annotations-holder","fairshare-annotations","dcs.prototype-6.state/fairshare-annotations-holder","dcs.prototype-6.util/easier-repo-data","meta","dcs.prototype-6.state/meta-holder","co2e-multiplier","dcs.prototype-6.state/co2e-multiplier-holder","population","population-scotland","dcs.prototype-6.data-shaping/rollup-population-regions","population-scotGovTarget","p1__38747#","cljs.core.map","cljs.core.assoc","dcs.prototype-6.state/population-holder","cljs.core.concat","household-waste","household-waste-scotland","dcs.prototype-6.data-shaping/rollup-household-waste-regions","household-waste-scotGovTarget","dcs.prototype-6.data-shaping/calc-scotGovTarget-for-household-waste","dcs.prototype-6.state/household-waste-holder","household-co2e","dcs.prototype-6.data-shaping/rollup-household-co2e-regions","dcs.prototype-6.state/household-co2e-holder","business-waste-by-region","business-waste-by-region-scotland","dcs.prototype-6.data-shaping/rollup-business-waste-by-region-regions","business-waste-by-region-scotGovTarget","dcs.prototype-6.data-shaping/calc-scotGovTarget-for-business-waste-by-region","dcs.prototype-6.state/business-waste-by-region-holder","waste-site","dcs.prototype-6.state/waste-site-holder","stirling-bin-collection","dcs.prototype-6.state/stirling-bin-collection-holder","fairshare","dcs.prototype-6.state/fairshare-holder","stirling-community-food-tonnes","dcs.prototype-6.state/stirling-community-food-tonnes-holder","stirling-community-food-footfall","dcs.prototype-6.state/stirling-community-food-footfall-holder","ace-furniture-to-scottishCarbonMetric","dcs.prototype-6.state/ace-furniture-to-scottishCarbonMetric-holder","household-waste-analysis","dcs.prototype-6.state/household-waste-analysis-holder"],"sourcesContent":["(ns dcs.prototype-6.loader\n  (:require [clojure.string :as str]\n            [cljs-http.client :as http]\n            [cljs.core.async :refer [<!]]\n            [testdouble.cljs.csv :as csv]\n            [dcs.prototype-6.util :as util]\n            [dcs.prototype-6.state :as state]\n            [dcs.prototype-6.data-shaping :as data-shaping])\n  (:require-macros [cljs.core.async.macros :refer [go]]))\n\n\n(defn fetch\n      [url body-handler]\n      (js/console.log (str \"Fetching \" url))\n      (go (let [start-time (util/now)\n                response (<! (http/get url {:with-credentials? false}))]\n                 (js/console.log (str \"Response from \" url \": status=\" (:status response) \" success=\" (:success response) \" secs-taken=\" (util/secs-to-now start-time)))\n                 (let [body (:body response)\n                       clj-body (cond\n                                  (str/ends-with? url \".csv\") (csv/read-csv (str/replace body \"\\r\" \"\")) ;; parse as CSV (and remove \\r chars since they're troublesome with this CSV lib in this context)\n                                  (string? body) (js->clj (.parse js/JSON body) :keywordize-keys true) ;; probably a text/plain response that we'll have to explicitly convert to Clojure data\n                                  :else body ;; probably an application/json response causing cljs-http to have aleady auto converted the JSON to Clojure data\n                                  )] \n                      (body-handler clj-body)))))\n\n(defn load-data\n  []\n  (js/console.log \"Loading data files\")\n  \n  (fetch \"ace-furniture-count.json\"\n         (fn [ace-furniture-count] (->> ace-furniture-count\n                                        (reset! state/ace-furniture-count-holder))))\n\n  (fetch \"ace-furniture-avg-weight.json\"\n         (fn [ace-furniture-avg-weight] (->> ace-furniture-avg-weight\n                                             (reset! state/ace-furniture-avg-weight-holder))))\n  \n  (fetch \"geojson.json\"\n         (fn [geojson] (->> geojson\n                            clj->js\n                            (reset! state/geojson-cursor))))\n  \n  (fetch \"regional-dashboard-annotations.csv\"\n         (fn [regional-dashboard-annotations] (->> regional-dashboard-annotations\n                                                   (reset! state/regional-dashboard-annotations-holder))))\n  \n  (fetch \"household-waste-analysis-annotations.csv\"\n         (fn [household-waste-analysis-annotations] (->> household-waste-analysis-annotations\n                                                         (reset! state/household-waste-analysis-annotations-holder))))\n  \n  (fetch \"fairshare-annotations.csv\"\n         (fn [fairshare-annotations] (->> fairshare-annotations\n                                          (reset! state/fairshare-annotations-holder))))\n\n  (fetch (str util/easier-repo-data \"meta.json\")\n         (fn [meta] (->> meta\n                         (reset! state/meta-holder))))\n\n\n  (fetch (str util/easier-repo-data \"co2e-multiplier.json\") \n         (fn [co2e-multiplier] (->> co2e-multiplier\n                                    (reset! state/co2e-multiplier-holder))))\n  \n  (fetch (str util/easier-repo-data \"population.json\")\n         (fn [population] (let [population-scotland      (data-shaping/rollup-population-regions population)\n                                ;; fabricate records that will be used to calculate \"Scottish government target\" values\n                                ;; (fabricated records will be the same as the records for \"Scotland\", just with a different :region value)\n                                population-scotGovTarget (map #(assoc % :region \"Scot gov target\") population-scotland)]\n                            (reset! state/population-holder\n                                    (concat population\n                                            population-scotland\n                                            population-scotGovTarget)))))\n\n  (fetch (str util/easier-repo-data \"household-waste.json\")\n         (fn [household-waste] (let [household-waste-scotland      (data-shaping/rollup-household-waste-regions household-waste)\n                                     household-waste-scotGovTarget (data-shaping/calc-scotGovTarget-for-household-waste household-waste-scotland)]\n                                 (reset! state/household-waste-holder\n                                         (concat household-waste \n                                                 household-waste-scotland\n                                                 household-waste-scotGovTarget)))))\n\n  (fetch (str util/easier-repo-data \"household-co2e.json\")\n         (fn [household-co2e] (->> household-co2e\n                                   data-shaping/rollup-household-co2e-regions\n                                   (concat household-co2e)\n                                   (reset! state/household-co2e-holder))))\n\n  (fetch (str util/easier-repo-data \"business-waste-by-region.json\")\n         (fn [business-waste-by-region] (let [business-waste-by-region-scotland      (data-shaping/rollup-business-waste-by-region-regions business-waste-by-region)\n                                              business-waste-by-region-scotGovTarget (data-shaping/calc-scotGovTarget-for-business-waste-by-region business-waste-by-region-scotland)]\n                                          (reset! state/business-waste-by-region-holder\n                                                  (concat business-waste-by-region\n                                                          business-waste-by-region-scotland\n                                                          business-waste-by-region-scotGovTarget)))))\n\n  (fetch (str util/easier-repo-data \"waste-site-io.json\")\n         (fn [waste-site] (->> waste-site\n                               (reset! state/waste-site-holder))))\n\n  (fetch (str util/easier-repo-data \"bin-collection.json\")\n         (fn [stirling-bin-collection] (->> stirling-bin-collection\n                                            (reset! state/stirling-bin-collection-holder))))\n  \n  (fetch (str util/easier-repo-data \"fairshare.json\")\n         (fn [fairshare] (->> fairshare\n                              (reset! state/fairshare-holder))))\n  \n  (fetch (str util/easier-repo-data \"stirling-community-food-tonnes.json\")\n         (fn [stirling-community-food-tonnes] (->> stirling-community-food-tonnes\n                                                   (reset! state/stirling-community-food-tonnes-holder))))\n\n  (fetch (str util/easier-repo-data \"stirling-community-food-footfall.json\")\n         (fn [stirling-community-food-footfall] (->> stirling-community-food-footfall\n                                                     (reset! state/stirling-community-food-footfall-holder))))\n\n  (fetch (str util/easier-repo-data \"ace-furniture-to-scottishCarbonMetric.json\")\n         (fn [ace-furniture-to-scottishCarbonMetric] (->> ace-furniture-to-scottishCarbonMetric\n                                                          (reset! state/ace-furniture-to-scottishCarbonMetric-holder))))\n\n  (fetch (str util/easier-repo-data \"household-waste-analysis.json\")\n         (fn [household-waste-analysis] (->> household-waste-analysis\n                                             (reset! state/household-waste-analysis-holder)))))\n"]}