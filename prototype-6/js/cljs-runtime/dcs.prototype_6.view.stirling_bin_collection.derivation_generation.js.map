{"version":3,"sources":["dcs/prototype_6/view/stirling_bin_collection/derivation_generation.cljs"],"mappings":"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","names":["dcs.prototype-6.view.stirling-bin-collection.derivation-generation/chart-spec","title","data","quarter-count","cljs.core/count","cljs.core/group-by","cljs.core.juxt","dcs.prototype-6.view.stirling-bin-collection.derivation-generation/chart","stirling-bin-collection-derivation-generation","household-waste-derivation-generation","ctx-min-year","cljs.core.map","cljs.core.apply","cljs.core/min","household-waste-derivation-generation'","p1__27990#","cljs.core.filter","p1__27991#","cljs.core/contains?","p1__27992#","cljs.core.assoc","household-waste-derivation-generation''","p__27995","map__27996","cljs.core/--destructure-map","cljs.core.get","region","year","tonnes","quarterly-tonnes","iter__4564__auto__","s__27998","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4562__auto__","size__4563__auto__","b__28000","cljs.core/chunk-buffer","i__27999","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__27997","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","quarter","cljs.core/flatten","stirling-bin-collection-derivation-generation'","p1__27993#","derivation-generation'","cljs.core.concat","derivation-generation''","p1__27994#","dcs.prototype-6.util/date-str","oz.core/vega-lite","dcs.prototype-6.util/vega-embed-opts","cljs.core/deref","dcs.prototype-6.view.stirling-bin-collection.derivation-generation/root","dcs.prototype-6.state/stirling-bin-collection-derivation-generation-cursor","dcs.prototype-6.state/household-waste-derivation-generation-cursor","cljs.core/chunk-first"],"sourcesContent":["(ns dcs.prototype-6.view.stirling-bin-collection.derivation-generation\n  (:require\n    [reagent.core :as r]\n    [oz.core :as oz]\n    [dcs.prototype-6.util :as util]\n    [dcs.prototype-6.state :as state]))\n\n\n(defn chart-spec [title data]\n      (let [quarter-count (count (group-by (juxt :year :quarter) data))]\n           {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n            ;;:title      title\n            :width      250\n            :height     100\n            :background \"floralwhite\"\n            :data       {:values data}\n            :mark       {:type \"line\" :point {:filled false :fill \"floralwhite\"}}\n            :selection  {:my {:type   \"multi\"\n                              :fields [\"region\"]\n                              :bind   \"legend\"}}\n            :encoding   {:x       {:timeUnit \"yearquarter\"\n                                   :field    \"date\"\n                                   :type \"temporal\"\n                                   :axis     {:tickCount quarter-count\n                                              :title      \"year quarter\"\n                                              :labelAngle 60\n                                              :labelBound 45}}\n                         :y       {:field \"tonnes\" :type \"quantitative\"\n                                   ;:scale {:domain [0.03 0.1]}\n                                   :axis  {:title \"tonnes per citizen\"}}\n                         :color   {:field \"region\" :type \"nominal\"\n                                   :scale {:domain [\"Scotland (all means)\" \"Stirling (all means)\" \"Stirling (bin collection)\"]\n                                           :range  [\"#bcd6e9\" \"#fedfc4\" \"#BF5748\"]}\n                                   :axis  {:title \"category\"}}\n                         :opacity {:condition {:selection \"my\" :value 1}\n                                   :value     0.2}\n                         :tooltip [{:field \"region\" :type \"nominal\" :title \"category\"}\n                                   {:field \"date\" :type \"temporal\" }\n                                   {:field \"tonnes\" :type \"quantitative\" :title \"tonnes per citizen\"}]}}))\n\n(defn chart [stirling-bin-collection-derivation-generation household-waste-derivation-generation]\n      (let [;; min year to be used to filter the context data is 1 year less than the min year of the Stirling bin collection data\n            ctx-min-year (->> stirling-bin-collection-derivation-generation\n                              (map :year)\n                              (apply min)\n                              dec)\n\n            ;; filter for Scotland and Stirling in the more general household waste data\n            household-waste-derivation-generation' (->> household-waste-derivation-generation\n                                                        (filter #(>= (:year %) ctx-min-year)) ;; we only want a specific range of years\n                                                        (filter #(contains? #{\"Scotland\" \"Stirling\"} (:region %))) ;; we only want Scotland and Stirling\n                                                        (map #(assoc % :region (str (:region %) \" (all means)\")))) ;; re-label\n\n            ;; estimate the quarterly figures by simply dividing by 4\n            household-waste-derivation-generation'' (->> household-waste-derivation-generation'\n                                                         (map (fn [{:keys [region year tonnes]}]\n                                                                  (let [quarterly-tonnes (double (/ tonnes 4))]\n                                                                       (for [quarter [1 2 3 4]]\n                                                                            {:region  region\n                                                                             :year    year\n                                                                             :quarter quarter\n                                                                             :tonnes  quarterly-tonnes}))))\n                                                         flatten)\n\n\n            ;; add \" (bins)\" to the label for Stirling\n            stirling-bin-collection-derivation-generation' (map #(assoc % :region \"Stirling (bin collection)\")\n                                                                stirling-bin-collection-derivation-generation)\n\n            ;; combine Stirling bin collection data with that for the more general household waste of Stirling and Scotland\n            derivation-generation' (concat stirling-bin-collection-derivation-generation'\n                                           household-waste-derivation-generation'')\n\n            ;; construct a date field for Vega\n            derivation-generation'' (map #(assoc % :date (util/date-str (:year %) (:quarter %)))\n                                         derivation-generation')]\n\n           [:div\n            [oz/vega-lite (chart-spec \"Amount\" derivation-generation'')\n             util/vega-embed-opts]]))\n\n(defn root []\n      [chart\n       @state/stirling-bin-collection-derivation-generation-cursor\n       @state/household-waste-derivation-generation-cursor])"]}