{"version":3,"sources":["dcs/prototype_6/view/household_waste_analysis/detail.cljs"],"mappings":"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","names":["dcs.prototype-6.view.household-waste-analysis.detail/stratum-labels","dcs.prototype-6.view.household-waste-analysis.detail/layer-normal","dcs.prototype-6.view.household-waste-analysis.detail/layer-red-outlines","cljs.core.assoc","cljs.core/assoc-in","dcs.prototype-6.view.household-waste-analysis.detail/layer-annotations","dcs.prototype-6.annotation-mech/layer-annotations","dcs.prototype-6.view.household-waste-analysis.detail/chart-spec","chart-data","title","dcs.prototype-6.view.household-waste-analysis.detail/charts","derivation","annotations","dcs.prototype_6.annotation_mech.apply_annotations","goog.string/unescapeEntities","oz.core/vega-lite","dcs.prototype-6.util/vega-embed-opts","cljs.core/deref","dcs.prototype-6.view.household-waste-analysis.detail/root","dcs.prototype-6.state/household-waste-analysis-derivation-cursor","dcs.prototype-6.state/annotations-derivation-cursor"],"sourcesContent":["(ns dcs.prototype-6.view.household-waste-analysis.detail\n  (:require\n   [oz.core :as oz]\n   [goog.string :as gstring]\n   [dcs.prototype-6.util :as util]\n   [dcs.prototype-6.annotation-mech :as anno-mech]\n   [dcs.prototype-6.state :as state]))\n\n(def stratum-labels [\"urban \u00a3\" \"urban \u00a3\u00a3\" \"urban \u00a3\u00a3\u00a3\" \"rural \u00a3/\u00a3\u00a3\" \"rural \u00a3\u00a3\u00a3\"])\n\n(def layer-normal {:mark \"bar\"\n                 :encoding {:x {:field \"kg\" :type \"quantitative\" :scale {:type \"sqrt\"} :axis {:title \"avg kg/hh/wk\"}}\n                            :y {:field \"stream\" :type \"nominal\" :axis {:title \"\"}}\n                            :color {:field \"material-L2\" :type \"nominal\"\n                                    :scale {:scheme \"tableau20\"}\n                                    :legend nil}\n                            :fillOpacity {:value 0.5}\n                            :tooltip [{:field \"stratum\" :type \"nominal\" :title \"house type (location & CTax)\"}\n                                      {:field \"material-L1\" :type \"nominal\" :title \"material (high level)\"}\n                                      {:field \"material-L2\" :type \"nominal\" :title \"material (in detail)\"}\n                                      {:field \"stream\" :type \"nominal\" :title \"(actual) disposal\"}\n                                      {:field \"idealStream\" :type \"nominal\" :title \"ideal disposal\"}\n                                      {:field \"kg\" :type \"quantitative\" :format \".4f\" :title \"kg per household per week\"}]}})\n(def layer-red-outlines (-> layer-normal\n                            (assoc :transform [{:filter \"(datum.kg > 0) && (datum.stream != datum.idealStream)\"}])\n                            (assoc-in [:encoding :fillOpacity :value] 0)\n                            (assoc-in [:encoding :stroke :value] \"red\")\n                            (assoc-in [:encoding :strokeWidth :value] 1)))\n(def layer-annotations (-> anno-mech/layer-annotations\n                           (assoc-in [:encoding :x] (-> layer-normal :encoding :x))\n                           (assoc-in [:encoding :y] (-> layer-normal :encoding :y))))\n\n(defn chart-spec\n      [chart-data title]\n      {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n       :background \"floralwhite\"\n       :spacing 3\n       :config {:title {:anchor \"center\"}}\n       :title title\n       :data       {:values chart-data}\n       :transform  [{:aggregate [{:op \"mean\" :field \"kgPerHhPerWk\" :as \"kg\"}]\n                     :groupby [\"stratum\" \"material-L1\" \"material-L2\" \"stream\" \"idealStream\" \"annotation\" \"annotation-text\" \"annotation-url\"]}]\n       :facet     {:column {:field \"stratum\" :type \"nominal\"\n                            :sort stratum-labels\n                            :header {:title \"household type (location type & council tax band)\"}}\n                   :row {:field \"material-L2\" :type \"nominal\"\n                         :header {:title \"material (in detail)\" :labelAngle 0 :labelAlign \"left\"}\n                         :sort {:field \"kg\" :op \"max\" :order \"descending\"}}}\n       :spec {:width 130\n              :height 20\n              :layer [layer-normal\n                      layer-red-outlines\n                      layer-annotations]}})\n\n(defn charts [derivation annotations]\n  (let [chart-data (anno-mech/apply-annotations annotations derivation :household-waste-analysis-derivation)]\n    [:div.columns\n     [:column\n      [:div.m-4.content\n       [:p \"Graph 3 [below] conveys a fair amount of information!\"]\n       [:p.has-text-info \"As before, hover/click on a bar in the graph to be shown more detailed information.\"\n        [:br]\n        \" The bars with a \" [:span.has-text-danger.has-text-weight-bold \"red\"] \" outline represent \"\n        [:em.has-text-danger \"inappropriate disposal\"] \".\"\n        [:br]\n        [:p \"The categories are ordered by: heaviest \" [:em \"sub-breakdown\"] \" first.\"]]\n       [:p \"Again we can see [on the top row] that \" [:span.has-text-warning \"rural \u00a3/\u00a3\u00a3\"] \" households dispose of a lot of fine-grained material,\"\n        \" i.e.\" (gstring/unescapeEntities \"&nbsp;\") [:span.has-text-warning \"Fines\" (gstring/unescapeEntities \"&nbsp;\") \"(<10mm)\"] \".\"\n        \" Also, they dispose of a sizable portion of it \" [:em.has-text-danger \"inappropriately\"] \" in \" [:span.has-text-warning \"recycling bin\"] \"s.\"]\n       [:p \"For some categories (e.g. \"\n        [:span.has-text-warning \"Unavoidable food waste\"]\n        \", \" [:span.has-text-warning \"Avoidable food waste\"]\n        \" and \" [:span.has-text-warning \"Clear container glass\"]\n        \") \" [:b \"both\"] \" bars (\"\n        [:span.has-text-warning \"grey bin\"]\n        \" and \" [:span.has-text-warning \"recycling bin\"]\n        \") are outlined in \" [:span.has-text-danger \"red\"] \". Why?\"\n        \" ...Probably because the bins that are appropriate for those categories,\"\n        \" were not covered by the dataset.\"\n        \" (E.g. because the appropriate bins are actually fixed containers at recyling points; or because they were collected at times outside of the sampling periods.)\"\n        \" We will ask ZWS to confirm this interpretation.\"]\n       [:p [:span.has-text-warning \"urban \u00a3\u00a3\u00a3\"] \" households dispose of a lot of \"\n        [:span.has-text-warning \"Green garden waste\"] \" \" [:em.has-text-danger \"inappropriately\"]\n        \" in comparison to their \" [:span.has-text-warning \"rural \u00a3\u00a3\u00a3\"] \" peers [see the 18\" [:sup \"th\"] \" category down].\"\n        \" Is that because \" [:span.has-text-warning \"urban \u00a3\u00a3\u00a3\"] \" households have fewer convenient spaces in which to heap their garden waste!\"\n        \" Perhaps, but it is foolish to make such inferences from data (such as this) which covers a relatively small number of observations.\"]]\n\n      [oz/vega-lite (chart-spec chart-data \"Graph 3: Detailed disposal decisions per household type\")\n       util/vega-embed-opts]]]))\n\n(defn root []\n      [charts\n       @state/household-waste-analysis-derivation-cursor @state/annotations-derivation-cursor])\n"]}