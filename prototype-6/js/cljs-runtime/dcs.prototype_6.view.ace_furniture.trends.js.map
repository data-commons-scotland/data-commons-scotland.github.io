{"version":3,"sources":["dcs/prototype_6/view/ace_furniture/trends.cljs"],"mappings":"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","names":["dcs.prototype-6.view.ace-furniture.trends/chart-spec-category-level","data","cljs.core.conj","dcs.prototype-6.view.ace-furniture.shared/transform-spec","dcs.prototype-6.view.ace-furniture.trends/chart-spec-item-level","dcs.prototype-6.view.ace-furniture.trends/hint","dcs.prototype-6.view.ace-furniture.trends/tabbed-area","category-trends","item-trends","e","dcs.prototype-6.util/open-tab","oz.core/vega-lite","dcs.prototype-6.util/vega-embed-opts","cljs.core/deref","dcs.prototype-6.view.ace-furniture.trends/root","dcs.prototype-6.state/ace-furniture-counts-derivation-category-trends-cursor","dcs.prototype-6.state/ace-furniture-counts-derivation-item-trends-cursor"],"sourcesContent":["(ns dcs.prototype-6.view.ace-furniture.trends\n  (:require\n    [reagent.core :as r]\n    [oz.core :as oz]\n    [goog.string :as gstring]\n    [dcs.prototype-6.util :as util]\n    [dcs.prototype-6.state :as state]\n    [dcs.prototype-6.view.ace-furniture.shared :as shared]))\n\n\n(defn chart-spec-category-level\n      [data]\n      {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n       :background \"floralwhite\"\n       :data       {:values data}\n       :transform  (conj shared/transform-spec\n                         {:calculate \"truncate(datum.category, 30)\" :as \"categorytruncated\"})\n       :facet   {:field \"categorytruncated\"\n                 :type \"nominal\"\n                 :sort {:field \"trend\" :op \"mean\" :order \"descending\"}\n                 :header {:title \"category\" :titlePadding 30}}\n       :columns    4\n       :bounds \"flush\"\n       :spacing 35\n       ;:resolve {:axis {:x \"independent\" :y \"independent\"}}\n       :spec       {:width 130\n                    :height 50\n                    :layer [{:mark {:type \"line\"\n                                    :point {:filled false :fill \"#f2dfce\"}}\n                             :encoding   {:x       {:field \"instant\" :type \"temporal\"\n                                                    :axis {:title nil\n                                                           :format \"%b %y\"\n                                                           :labelAngle 90\n                                                           ;:labelBound 45\n                                                           }\n                                                    }\n                                          :y       {:field \"avg-count\" :type \"quantitative\"\n                                                    :axis {:title nil}\n                                                    :scale {:type \"sqrt\"}\n                                                    }\n                                          :color   {:condition {:test \"datum.trend >= 0\" :value \"#00769C\"}\n                                                    :value \"#B46E6F\"}\n                                          :tooltip [{:title \"category\" :field \"category\" :type \"nominal\"}\n                                                    {:title \"period\" :field \"period\" :type \"nominal\"}\n                                                    {:title \"total count for the period\" :field \"period-count\" :type \"quantitative\"}\n                                                    {:title \"avg count per month\" :field \"avg-count\" :type \"quantitative\"}\n                                                    {:title \"trend\" :field \"trend\" :type \"quantitative\"}]}\n\n                             }]\n                    }\n       })\n\n\n(defn chart-spec-item-level\n      [data]\n      {:schema     \"https://vega.github.io/schema/vega/v5.json\"\n       :background \"floralwhite\"\n       :data       {:values data}\n       :transform  (conj shared/transform-spec\n                         {:calculate \"truncate(datum.item, 30)\" :as \"itemtruncated\"})\n       :facet   {:field \"itemtruncated\"\n                 :type \"nominal\"\n                 :sort {:field \"trend\" :op \"max\" :order \"descending\"}\n                 :header {:title \"sub-category\" :titlePadding 30}}\n       :columns    5\n       :bounds \"flush\"\n       :spacing 35\n       ;:resolve {:axis {:x \"independent\" :y \"independent\"}}\n       :spec       {:width 130\n                    :height 50\n                    :layer [{:mark {:type \"line\"\n                                    :point {:filled false :fill \"#f2dfce\"}}\n                             :encoding   {:x       {:field \"instant\" :type \"temporal\"\n                                                    :axis {:title nil\n                                                           :format \"%b %y\"\n                                                           :labelAngle 90\n                                                           ;:labelBound 45\n                                                           }\n                                                    }\n                                          :y       {:field \"avg-count\" :type \"quantitative\"\n                                                    :axis {:title nil}\n                                                    :scale {:type \"sqrt\"}\n                                                    }\n                                          :color   {:condition {:test \"datum.trend >= 0\" :value \"#00769C\"}\n                                                    :value \"#B46E6F\"}\n                                          :tooltip [{:title \"category\" :field \"category\" :type \"nominal\"}\n                                                    {:title \"sub-category\" :field \"item\" :type \"nominal\"}\n                                                    {:title \"period\" :field \"period\" :type \"nominal\"}\n                                                    {:title \"total count for the period\" :field \"period-count\" :type \"quantitative\"}\n                                                    {:title \"avg count per month\" :field \"avg-count\" :type \"quantitative\"}\n                                                    {:title \"trend\" :field \"trend\" :type \"quantitative\"}]}\n\n                             }]\n                    }\n       })\n\n(def hint [:div.content.is-small.has-text-info-dark\n           [:p \"A circle on the a line represents the end of an \" [:em \"accounting\"] \" period.\"\n            \" Click on it to see further detail, including the \" [:em \"trend\"] \" value.\"\n            \" Each trend is calculated as a straight line approximation to the actual line, and the trend value is the slope of the line.\"\n            \" Upward trends are drawn in \" [:span.has-text-weight-bold {:style {:color \"#00769C\"}} \"blue\"]\n            \", downward trends in \" [:span.has-text-weight-bold {:style {:color \"#B46E6F\"}} \"red\"] \".\"\n            \" The furniture graphs are order by their trend - with the most positive (upward) trend first.\"\n            \" \" ]])\n\n(defn tabbed-area [category-trends item-trends]\n      [:div\n       [:div.tabs\n        [:ul\n         [:li.tab-trends.is-active {:on-click (fn [e] (util/open-tab e \"trends\" \"category-level\"))} [:a \"Less detail\"]]\n         [:li.tab-trends {:on-click (fn [e] (util/open-tab e \"trends\" \"item-level\"))} [:a \"More detail\"]]]]\n\n\n       [:div#category-level-trends.content.tab-content-trends\n        [:p \"The \" [:b \"trend\"] \" of the average-count-per-month of the items of furniture sold in each \" [:b \"category\"] \".\"]\n        hint\n        [:div.has-text-danger-dark\n         [:p \"The category \" [:span.has-text-grey \"Furniture\"] \" has the best trend (for the average number of items reused per month),\"\n          \" and the category \" [:span.has-text-grey \"Children's items\"] \" has the worse.\"]]\n        [oz/vega-lite (chart-spec-category-level category-trends) util/vega-embed-opts]\n        ]\n\n\n       [:div#item-level-trends.content.tab-content-trends {:style {:display \"none\"}}\n        [:p \"The \" [:b \"trend\"] \" of the average-count-per-month of the items of furniture sold in each \" [:b \"sub-category\"] \".\"]\n        hint\n        [:div.has-text-danger-dark\n         [:p \"The sub-category \" [:span.has-text-grey \"Chair, Kitchen, Dining or Wooden\"] \" has the best trend (for the average number of items reused per month),\"\n          \" and the sub-category \" [:span.has-text-grey \"Wardrobe, single\"] \" has the worse.\"]]\n        [oz/vega-lite (chart-spec-item-level item-trends) util/vega-embed-opts]\n        ]\n\n\n       ]\n      )\n\n(defn root []\n      [tabbed-area\n       @state/ace-furniture-counts-derivation-category-trends-cursor\n       @state/ace-furniture-counts-derivation-item-trends-cursor])"]}